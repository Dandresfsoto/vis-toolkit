<!doctype html>
<meta charset="utf-8">
<script src="../js/d3.js"></script>
<script src="../build/vistk.js"></script>
<link href="../css/vistk.css" rel="stylesheet">
<body>
<div id="viz"></div>

<script>

  // TODO
  // [X] Load Anscombe dataset
  // [ ] Derive descriptive statistics
  // [X] Init 4 tables
  // [X] Init 4 scatterplots
  // [ ] Customize tables (zebra, headers, ..)
  // [ ] Connect the charts

d3.csv("../data/anscombe.csv", function(graph) {

  data = [];

  graph.forEach(function(d) {
    
    d["x"] = +d["x"];
    d["y"] = +d["y"];

    data.push(d)
  })

  descriptive = []

  // Find unique categories
  var groups = d3.set(data.map(function(d) { return d["Group"]; })).values();

  groups.forEach(function(d) {

    // Create a table
    var table = vistk.viz()
      .params({
          type: "table",
          width: 800,
          height: 600,
          container: "#viz",
          data: data.filter(function(e) { return e["Group"] == d; }),
          columns: ['community_name', 'name', 'distance', 'pci', 'rca', 'share', 'year'],
          id: ["community_name", "name"],
          group: "community_name",
          text: "name",
          time: {
            var_time: "year", 
            current_time: 1995
          },
          title: "Products",
          var_color: "community_name"
        });

    d3.select("#viz").call(table);

    var scatterplot = vistk.viz()
      .params({
        dev: true,
        type: 'scatterplot',
        margin: {top: 10, right: 10, bottom: 30, left: 30},
        container: '#viz',
        data: data.filter(function(e) { return e["Group"] == d; }),
        var_id: 'name',
        var_group: 'continent',
        var_color: 'continent',
        var_x: 'nb_products',
        var_y: 'avg_products',
        var_r: 'nb_products',
        var_share: "avg_products",
        share_cutoff: function(d) { return d.avg_products > 30; },
        var_text: 'name_2char',
        time: {
          var_time: "year",
          current_time: "1995",
          parse: function(d) { return d; }
        },
        x_scale: [{
          domain: [0, 700]
        }],
        items: [{
          attr: "name",
          marks: [{
            type: 'circle'
          }]
        }],
        ui: {
          default: true,
          options: ["country", "continent"]
        },
        selection: ["France"],
        highlight: ["France", "Germany"],      
        title: "World Countries"
      });

    d3.select("#viz").call(scatterplot)


  })

})

</script>
