<!doctype html>
<meta charset="utf-8">
<script src="../js/d3.js"></script>
<script src="../build/vistk.js"></script>
<link href="../css/vistk.css" rel="stylesheet">
<body>
<div id="viz"></div>
<script>

d3.json("../data/countries.json", function(error, countries) {

//  var countries_enter = d3.select("body").data(countries).enter();

  // TODO
  // -Order countries by total exports
  // -Option to re-scale?
  // -Links to The Atlas
  // -Options to re-order by population
  // -Make it fit in the page
  // -Title
  // -Explanation
  // -Make it a treemap
  // -Gather as a total world export
  // d3.selectAll("rect").style("opacity", .3)

  var categories = [
    {name: 'Animal & Animal Products', pci: 20, opp_gain: 20, color: '#FFE999'},
    {name: 'Vegetable Products', pci: 30, opp_gain: 20, color: '#FFC41C'},
    {name: 'Foodstuffs', pci: 10, opp_gain: 20, color: '#DDFF48'},
    {name: 'Chemicals & Allied Industries', pci: 90, opp_gain: 20, color: '#E377C2'},
    {name: 'Mineral Products', pci: 19, opp_gain: 0, color: '#FFE999'},
    {name: 'Plastics / Rubbers', pci: 13, opp_gain: 30, color: '#F7B6D2'},
    {name: 'Raw Hides, Skins, Leather, & Furs', pci: 10, opp_gain: 20, color: '#98DF8A'},
    {name: 'Textiles', pci: 10, opp_gain: 42, color: '#2CA02C'},
    {name: 'Footwear / Headgear', pci: 20, opp_gain: 20, color: '#3AB11A'},
    {name: 'Wood & Wood Products', pci: 30, opp_gain: 20, color: '#E22020'},
    {name: 'Stone / Glass', pci: 10, opp_gain: 20, color: '#D66011'},
    {name: 'Metals', pci: 10, opp_gain: 20, color: '#5F2107'},
    {name: 'Machinery / Electrical', pci: 10, opp_gain: 20, color: '#65D4DF'},
    {name: 'Transportation', pci: 10, opp_gain: 20, color: '#9EDAE5'},
    {name: 'Miscellaneous', pci: 10, opp_gain: 20, color: '#7F7F7F'},
    {name: 'Service', pci: 10, opp_gain: 20, color: '#C6C6C6'}
  ];

  countries.sort(function(a, b) { return b.area - a.area; });

  countries.forEach(function(d, i) {

    var id = "country_" + d.cca3;

    d3.select("body").append("div").style("float", "left").attr("id", id);

    var data = [];

    categories.forEach(function(category, i) {
      var d = {};
      d.value_exports = 100*Math.random();
      d.value_imports = 100*Math.random();
      d.community_id = i;
      d.color = category.color;
      d.year = 2013;
      data.push(d);
    });

    var visualization = vistk.viz()
      .params({
        type: 'rectmap',
        container: "#" + id,
        height: 80,
        width: 60,
        margin: {top: 10, bottom: 10, left: 10, right: 10},
        data: data,
        var_sort: 'value_exports',
        var_group: 'community_id',
        var_color: 'color',
        var_size: 'value_exports',
        var_text: 'community_id',
        var_width: 'value_exports',
        var_height: 'value_imports',
        items: [{
          marks: [{
            type: "rect",
            fill: function(d) { return d['color']; },
            x: 0,
            y: 0,
            width: function(d) { return d.dx; },
            height: function(d) { return d.dy; }
          }]
        }],
        time: {
          var_time: 'year',
          current_time: 2013
        },
        title: d.cca3
      });

    d3.select("#" + id).call(visualization);

  });

});

</script>
</body>
