<!doctype html>
<meta charset="utf-8">
<script src="../js/d3.js" charset="utf-8"></script>
<script src="../js/vistk.js"></script>
<link href="../css/vistk.css" rel="stylesheet">
<body>
<div id="viz"></div>
<script>

d3.tsv("../data/COL_pop_realgdp_dept_2000-2013.txt", function(error, departments) {

  departments.forEach(function(d, i) {

    d.dept_pop = +d.dept_pop;
    d.year = +d.year;
    d.realgdp = +d.realgdp;
    d.realgdp_percap = +d.realgdp_percap;    
    d["sum(export_value)"] = +d["sum(export_value)"];
    d["value_added"] = +d["value_added"];

  })

  visualization = vistk.viz()
    .params({
      type: 'dotplot',      
      data: departments,
      container: '#viz',
      var_x: 'dept_pop',
      x_scale: 'linear',
      var_y: ['dept_pop', 'realgdp'],
      x_text: null,
      x_ticks: 10,
      mark: {
        type: "diamond",
        width: 10,
        height: 10
      }
    })
    .id("name")
    .group("dept_name")
    .text("dept_name")
    .selection([0])
    .highlight([0])
    .time({var_time: 'year', current_time: 2013})

  d3.select("#viz").call(visualization)

  // Additional options below
  d3.select("#viz").append("select")
    .attr("id", "select_var_x")
    .on("change", function(d) {

      visualization.params({
        var_x: this.value
      })
      d3.select("#viz").call(visualization)

    })
    .selectAll("option")
    .data(d3.keys(departments[0]))
  .enter()
    .append("option")
    .attr("value", function(d) { return d; })
    .html(function(d) { return d; })

    var label_radios = d3.select("#viz").selectAll(".aggregations").data(["index", "linear"])
      .enter()
        .append("label")
        .attr("class", "aggregations")

    // TODO: find levels of aggregation
    label_radios.append("input")
               .attr("type", "radio")
               .attr("id", "id")  
               .attr("value", function(d) { return d; })
               .attr("name", "radio-nest")
               .property("checked", true)
               .on("change", function(d) { 
                  visualization.params({
                    x_type: d
                  })
                  d3.select("#viz").call(visualization)
               });

    label_radios.append("span")
        .html(function(d) { 
          return d ;
        });

});

</script>